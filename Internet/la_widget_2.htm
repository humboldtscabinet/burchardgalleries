
var load_item = 0;
var itemJSON = "null"; 
var first_run = 0;
var none_found = 0;
var house_id = 196;
var cat_id = 0;
var auction_type = '';
var failover_html =  '<div style=\"margin:10px;text-align:center;\"> <div style=\'width:100%;text-align:center; margin: 15px 0px;\'> <a target=\'blank\' href=\"http://www.liveauctioneers.com/burchard-galleries-inc\"><img id=\'widget_img\' alt=\"\" style=\'height:100px; border:solid 4px #ddd;\' src=\'http://d3sbm51utxzt5m.cloudfront.net/static/awaiting_image.png\' /></a></div> <a style=\"text-decoration: none;color:black;\" target=\'blank\' href=\"http://www.liveauctioneers.com/burchard-galleries-inc\"> <div style=\'margin-bottom:8px;line-height:18px; height: 70px; overflow:hidden;\' id=\'title\'> Burchard Galleries Inc<br>on<br>Live Auctioneers! </div> </a> </div>';      
       
function load_new_item( div_id ) {    
	jQuery('#'+div_id).fadeOut('slow', function() {
    if( first_run = 1 ) {
    	var data = jQuery.parseJSON( itemJSON );
    	first_run = 0;
    }
    if( data && data[load_item] ) {
    	var html_string = get_widget_html( data[load_item] );
    	jQuery('#'+ div_id).html( html_string );
    	
    	load_item += 1;
    } else{ 
    	if( load_item == 0 ) {
	    	none_found = 1;
			jQuery('#'+ div_id).html( failover_html );	    	
	    } else {
	    	var html_string = get_widget_html( data[0] );
	    	jQuery('#'+ div_id).html( html_string );
	    	load_item = 1;
	    }
	   }
    
    jQuery('#widget_img').load( function() {
    	if( ( jQuery('#widget_img').height() * 1.5 ) >= jQuery('#widget_img').width() ) {
    		jQuery('#widget_img').height(100);
    	} else {
    		jQuery('#widget_img').width(150);
    	}
    });
    
    
    jQuery('#'+div_id).fadeIn('slow');
    if( !none_found ) {
    	setTimeout( "load_new_item('la_item_widget')", 8000 );
    }
  });
}

function open_bid_applet( cat_id ) {
    window.open('/bidapplet'+cat_id, 'BiddingApplet'+cat_id, 'toolbar=no,resizable=yes,location=no,status=no,menubar=no,scrollbars=no,height=660,width=940');
    return false;
}

function get_widget_html( data ) {
	var html = '<div style="margin:10px;text-align:center;"> \
        <div style=\'width:100%;text-align:center; margin: 15px 0px;\'> \
        <a target=\'blank\' href="'+data['lot_url']+'"> ';
    if( data['photo_1'] != 'n' ) {
        html += '<img id=\'widget_img\' alt="'+data['title']+'" style=\'height:100px; border:solid 4px #ddd;\' src=\'http://p2.la-img.com/'+data['houseID']+'/'+data['catID']+'/'+data['lotID']+'_1_m.jpg\' />';
    } else { 
        html += '<img id=\'widget_img\' alt="'+data['title']+'" style=\'height:100px; border:solid 4px #ddd;\' src=\'http://www.liveauctioneers.com/img_redirect/'+data['houseID']+'/'+data['catID']+'/'+data['lotID']+'_1_m.jpg\' />';
    }
    html += '</a></div> \
        <div style=\'margin-bottom:8px;line-height:18px; height: 36px; overflow:hidden;\' id=\'title\'>'+data['title']+'</div> ';
    if( data['ncatalog_status'] == 'online' ) {
        html += '<a style="text-decoration: none;" target=\'blank\' href="'+data['lot_url']+'"><span style="line-height:18px; padding:3px; width:auto; background-color:#A5F586; border: 1px solid #DDDDDD; color: black; font-weight: bold; text-align:center;">bid &raquo;</span></a>';
    }
    if( data['ncatalog_status'] == 'live' ) {
        html += '<a target=\'blank\' style=\'text-decoration: none;\'href="'+data['lot_url']+'"><span style="line-height:18px; padding:3px; width:auto; background-color:#A5F586; border: 1px solid #DDDDDD; color: black; font-weight: bold; text-align:center;">bid &raquo;</span></a> \
            <a target=\'blank\' style=\'color:red;font-weight:bold;text-decoration: none;\' onclick="open_bid_applet('+data['catID']+');" href="#"> \
                <span style="line-height:18px; padding:3px; width:auto; background-color:#F0F0F0; color: #FF0000; font-weight: bold; text-align:center;">bid live &raquo;</span></a>';
    }
    html += '</div>';
    return html;
}